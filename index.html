<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetiZero1.0</title>
    <style>
        /* Your CSS styles */
        body {
            font-family: Arial, sans-serif;
        }

        .container {
            text-align: center;
            margin-top: 50px;
        }

        #question-image-container {
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background-color: white;
            z-index: 1;
        }

        #question-image {
            max-width: 400px;
            height: 300px; /* 固定图片高度 */
            cursor: pointer;
        }

        #options-container {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }

        .option {
            flex: 0 0 calc(100% / 3 - 20px);
            margin: 5px;
            padding: 10px;
            border: 1px solid #ccc;
            cursor: pointer;
        }

        #next-button {
            padding: 10px 20px;
            cursor: pointer;
        }

        #result-container {
            text-align: center;
            margin-top: 50px;
            display: none;
        }

        /* 放大图片效果 */
        #overlay {
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
        }

        #overlay img {
            max-height: 80%;
            max-width: 80%;
            border: 5px solid white;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
        }

        /* Personal info form */
        #personal-info-form {
            display: none;
        }

        #personal-info-form input {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- HTML structure for quiz and overlay -->
    <div class="container" id="quiz-container">
        <!-- Question display -->
        <div id="question-display">
            <div id="instruction">请选择最可能的诊断</div>
            <div id="instruction">单击图片查看细节</div>
            <div id="question-number"></div>
            <div id="question-image-container">
                <img id="question-image" src="" alt="Question Image" onclick="showOverlay()">
            </div>
            <div id="options-container"></div>
        </div>
        
        <!-- Personal info form -->
        <div id="personal-info-form">
            <h2>Please provide your personal information:</h2>
            <input type="text" id="name" name="name" placeholder="Your Name/您的名字" required><br>
            <input type="text" id="title" name="title" placeholder="Your Title/您的职称" required><br>
            <input type="email" id="email" name="email" placeholder="Your Email/您的邮箱" required><br>
            <button onclick="submitPersonalInfo()">Submit</button>
        </div>

        <!-- Result display -->
        <div id="result-container">
            <h2>Quiz Completed!</h2>
            <h2>答题结果已保存至桌面</h2>
            <h2>请将结果发送至邮箱lt@jsiec.org</h2>
            <!-- <button id="download-result-button" onclick="downloadResult()">Download Result</button> -->
        </div>

        <!-- Overlay -->
        <div id="overlay" onclick="hideOverlay()">
            <img id="overlay-image" src="" alt="Overlay Image">
        </div>
    </div>

    <!-- External JS library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <!-- Your JavaScript code -->
    <script>
        // JavaScript code for the quiz

        // Array to store user responses
        const userResponses = [];

        // Array to store the paths of all images
        const imagePaths = [
            "RetiZero1.0/1.jpg",
            "RetiZero1.0/2.png",
            "RetiZero1.0/3.jpg",
            "RetiZero1.0/4.jpg",
            "RetiZero1.0/5.png",
            "RetiZero1.0/6.jpg",
            "RetiZero1.0/7.jpg",
            "RetiZero1.0/8.png",
            "RetiZero1.0/9.png",
            "RetiZero1.0/10.png",
            "RetiZero1.0/11.jpg",
            "RetiZero1.0/12.png",
            "RetiZero1.0/13.jpg",
            "RetiZero1.0/14.jpg",
            "RetiZero1.0/15.png",
            "RetiZero1.0/16.png",
            "RetiZero1.0/17.jpg",
            "RetiZero1.0/18.jpg",
            "RetiZero1.0/19.jpg",
            "RetiZero1.0/20.jpg",
            "RetiZero1.0/21.jpg",
            "RetiZero1.0/22.jpg",
            "RetiZero1.0/23.jpg",
            "RetiZero1.0/24.png",
            "RetiZero1.0/25.jpg",
            "RetiZero1.0/26.jpg",
            "RetiZero1.0/27.jpg",
            "RetiZero1.0/28.png",
            "RetiZero1.0/29.png",
            "RetiZero1.0/30.jpg",
            "RetiZero1.0/31.jpg",
            "RetiZero1.0/32.jpg",
            "RetiZero1.0/33.jpg",
            "RetiZero1.0/34.jpg",
            "RetiZero1.0/35.png",
            "RetiZero1.0/36.jpg",
            "RetiZero1.0/37.jpg",
            "RetiZero1.0/38.jpg",
            "RetiZero1.0/39.png",
            "RetiZero1.0/40.png",
            "RetiZero1.0/41.jpg",
            "RetiZero1.0/42.jpg",
            "RetiZero1.0/43.jpg",
            "RetiZero1.0/44.jpg",
            "RetiZero1.0/45.jpg",
            "RetiZero1.0/46.jpg",
            "RetiZero1.0/47.jpg",
            "RetiZero1.0/48.jpg",
            "RetiZero1.0/49.jpg",
            "RetiZero1.0/50.jpg",
            "RetiZero1.0/51.jpg",
            "RetiZero1.0/52.png",
            "RetiZero1.0/53.jpg",
            "RetiZero1.0/54.png",
            "RetiZero1.0/55.jpg",
            "RetiZero1.0/56.jpg",
            "RetiZero1.0/57.png",
            "RetiZero1.0/58.jpg",
            "RetiZero1.0/59.png",
            "RetiZero1.0/60.png",
            "RetiZero1.0/61.jpg",
            "RetiZero1.0/62.jpg",
            "RetiZero1.0/63.jpg",
            "RetiZero1.0/64.jpg",
            "RetiZero1.0/65.jpg",
            "RetiZero1.0/66.jpg",
            "RetiZero1.0/67.png",
            "RetiZero1.0/68.png",
            "RetiZero1.0/69.jpg",
            "RetiZero1.0/70.jpg",
            "RetiZero1.0/71.jpg",
            "RetiZero1.0/72.jpg",
            "RetiZero1.0/73.jpg",
            "RetiZero1.0/74.jpg",
            "RetiZero1.0/75.jpg",
            "RetiZero1.0/76.jpg",
            "RetiZero1.0/77.jpg",
            "RetiZero1.0/78.jpg",
            "RetiZero1.0/79.jpg",
            "RetiZero1.0/80.jpg",
            "RetiZero1.0/81.png",
            "RetiZero1.0/82.jpg",
            "RetiZero1.0/83.png",
            "RetiZero1.0/84.jpg",
            "RetiZero1.0/85.jpg",
            "RetiZero1.0/86.jpg",
            "RetiZero1.0/87.png",
            "RetiZero1.0/88.jpg",
            "RetiZero1.0/89.jpg",
            "RetiZero1.0/90.png",
            "RetiZero1.0/91.jpg",
            "RetiZero1.0/92.jpg",
            "RetiZero1.0/93.jpg",
            "RetiZero1.0/94.jpg",
            "RetiZero1.0/95.jpg",
            "RetiZero1.0/96.png",
            "RetiZero1.0/97.jpg",
            "RetiZero1.0/98.png",
            "RetiZero1.0/99.png",
            "RetiZero1.0/100.jpg",
            "RetiZero1.0/101.jpg",
            "RetiZero1.0/102.jpg",
            "RetiZero1.0/103.jpg",
            "RetiZero1.0/104.jpg",
            // Add more image paths as needed
        ];

        // Array of fixed options for all questions
        const options = [
            "0.Acute Posterior Multifocal Placoid Pigment Epitheliopathy",
            "1.Acute Retinal Necrosis",
            "2.Albinism",
            "3.Angioid Streaks",
            "4.Asteroid Hyalosis",
            "5.Behcet disease",
            "6.BEST disease",
            "7.Bietti Crystalline Dystrophy",
            "8.Branch Retinal Vein Occlusion",
            "9.Central Retinal Vein Occlusion",
            "10.Central Serous Chorioretinopathy",
            "11.Chorioretinal Coloboma",
            "12.Choroidal Metastasis",
            "13.Choroidal Rupture",
            "14.Commotio Retinae",
            "15.Moderate Non-Proliferative Diabetic Retinopathy",
            "16.Severe Non-Proliferative Diabetic Retinopathy",
            "17.Proliferative Diabetic Retinopathy",
            "18.Epiretinal Membrane",
            "19.Geographic Atrophy",
            "20.Glaucoma",
            "21.Hypertensive Retinopathy",
            "22.Intraocular Foreign Body",
            "23.Leber Congenital Amaurosis",
            "24.Leukemic Retinopathy",
            "25.Lipemia Retinalis",
            "26.Macular Hole",
            "27.Morning Glory Anomaly",
            "28.Multiple Evanescent White-Dot Syndromes",
            "29.Myelinated Nerve Fiber",
            "30.Neovascular Age-related Macular Degeneration",
            "31.Normal",
            "32.Optic Atrophy",
            "33.Optic Disc Coloboma",
            "34.Pathologic Myopia",
            "35.Pigmented Paravenous Retinochoroidal Atrophy",
            "36.Polypoidal Choroidal Vasculopathy",
            "37.Presumed Ocular Histoplasmosis Syndrome",
            "38.Punctate Inner Choroidopathy_Multifocal Choroiditis",
            "39.Purtscher Retinopathy",
            "40.Retinal Arterial Macroaneurysm",
            "41.Retinal Detachment",
            "42.Retinal Racemose Hemangioma",
            "43.Retinitis Pigmentosa",
            "44.Retinoblastoma",
            "45.Roth Spots",
            "46.Serpiginous Choroidopathy",
            "47.Stargardt disease",
            "48.Syphilitic Uveitis",
            "49.Valsalva Retinopathy",
            "50.Vogt-Koyanagi-Harada disease",
            "51.X-linked Retinoschisis",    
            // Options list
        ];

        // Variable to keep track of current question index
        let currentQuestionIndex = 0;

        // Variable to store start time of the quiz
        let quizStartTime;

        // Function to load the next question
        function loadNextQuestion() {
            if (currentQuestionIndex < imagePaths.length) {
                const questionNumber = document.getElementById("question-number");
                questionNumber.innerText = `第 ${currentQuestionIndex + 1} 题`;

                const imagePath = imagePaths[currentQuestionIndex];
                const questionImage = document.getElementById("question-image");
                questionImage.src = imagePath;

                // Clear previous options
                const optionsContainer = document.getElementById("options-container");
                optionsContainer.innerHTML = "";

                // Add options dynamically
                options.forEach(option => {
                    const optionElement = document.createElement("div");
                    optionElement.classList.add("option");
                    optionElement.innerText = option;
                    optionElement.addEventListener("click", handleOptionClick);
                    optionsContainer.appendChild(optionElement);
                });

                // Increment question index
                currentQuestionIndex++;

                // Start the timer if it's the first question
                if (currentQuestionIndex === 1) {
                    quizStartTime = new Date();
                }
            } else {
                // Hide question display
                document.getElementById("question-display").style.display = "none";

                // Show personal info form
                document.getElementById("personal-info-form").style.display = "block";
            }
        }

        // Function to handle option click
        function handleOptionClick(event) {
            const selectedOption = event.target.innerText;
            userResponses.push(selectedOption);
            loadNextQuestion();
        }

        // Function to download result as Excel file
        function downloadResult() {
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet([["姓名", "职称", "邮箱", "问题", "答案", "答题时间 (秒)"]]);

            // Add user information and quiz results to the worksheet
            const name = document.getElementById("name").value;
            const title = document.getElementById("title").value;
            const email = document.getElementById("email").value;

            userResponses.forEach((response, index) => {
                const timeTaken = Math.round((new Date() - quizStartTime) / 1000); // Calculate time taken in seconds
                XLSX.utils.sheet_add_aoa(ws, [[name, title, email, `问题 ${index + 1}`, response, timeTaken]], {origin: -1});
            });

            XLSX.utils.book_append_sheet(wb, ws, "Quiz Result");
            const wbout = XLSX.write(wb, {bookType:'xlsx',  type: 'binary'});

            function s2ab(s) {
                const buf = new ArrayBuffer(s.length);
                const view = new Uint8Array(buf);
                for (let i = 0; i != s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF;
                return buf;
            }

            saveAs(new Blob([s2ab(wbout)],{type:"application/octet-stream"}), 'quiz_result.xlsx');
        }

        // Function to submit personal information
        function submitPersonalInfo() {
            const name = document.getElementById("name").value;
            const title = document.getElementById("title").value;
            const email = document.getElementById("email").value;

            if (name && title && email) {
                // Hide personal info form
                document.getElementById("personal-info-form").style.display = "none";

                // Display result container
                document.getElementById("result-container").style.display = "block";

                // Trigger download result function
                downloadResult();
            } else {
                alert("请填写完整个人信息！");
            }
        }

        // Function to show overlay with enlarged image
        function showOverlay() {
            const overlay = document.getElementById("overlay");
            const overlayImage = document.getElementById("overlay-image");
            const questionImage = document.getElementById("question-image");
            overlayImage.src = questionImage.src;
            overlay.style.display = "flex";
        }

        // Function to hide overlay
        function hideOverlay() {
            const overlay = document.getElementById("overlay");
            overlay.style.display = "none";
        }

        // Load the first question when the page loads
        window.onload = function() {
            loadNextQuestion();
        };

        // Start the quiz when the page is loaded
        window.onload = loadNextQuestion;
    </script>
</body>
</html>
