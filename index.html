<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetiZero1.0</title>
    <style>
        /* Your CSS styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        .container {
            text-align: center;
            margin-top: 50px;
            position: relative;
        }

        #question-image-container {
            margin-bottom: 20px;
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1;
            background-color: white;
            padding: 10px;
        }

        #question-image {
            max-width: 400px;
            height: 300px;
            cursor: pointer;
        }

        #question-display {
            margin-top: 350px;
        }

        #options-container {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }

        .option {
            flex: 0 0 calc(100% / 3 - 20px);
            margin: 5px;
            padding: 10px;
            border: 1px solid #ccc;
            cursor: pointer;
        }

        .option.selected {
            background-color: #f0f0f0;
        }

        #button-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: white;
            padding: 10px 20px;
            border: 1px solid #ccc;
            z-index: 1;
        }

        #button-container button {
            margin: 0 10px;
            padding: 5px 10px;
            cursor: pointer;
        }

        #result-container {
            text-align: center;
            margin-top: 50px;
            display: none;
        }

        /* Overlay styles */
        #overlay {
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
        }

        #overlay img {
            max-height: 80%;
            max-width: 80%;
            border: 5px solid white;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
        }

        /* Personal info form */
        #personal-info-form {
            display: none;
        }

        #personal-info-form input {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- HTML structure for quiz and overlay -->
    <div class="container" id="quiz-container">
        <!-- Image container -->
        <div id="question-image-container">
            <img id="question-image" src="" alt="Question Image" onclick="showOverlay()">
        </div>

        <!-- Question display -->
        <div id="question-display">
            <div id="instruction">图片加载缓慢，请耐心等待 / Image loading slow, please be patient~</div>
            <div id="instruction">单击图片查看细节 / Click on the image to view details</div>
            <div id="instruction">请选择最可能的诊断后，点击下一题</div>
            <div id="instruction">Please select the most likely diagnosis, and click on the next button</div>
            <div id="question-number"></div>
            <div id="options-container"></div>         
        </div>

        <!-- Button container -->
        <div id="button-container">
            <button id="prev-button" onclick="loadPrevQuestion()">Previous</button>
            <button id="next-button" onclick="loadNextQuestion()">Next</button>
        </div>
        
        <!-- Personal info form -->
        <div id="personal-info-form">
            <h2>Please provide your personal information:</h2>
            <input type="text" id="name" name="name" placeholder="您的名字/ Your Name" required><br>
            <input type="text" id="title" name="title" placeholder="您的职称/ Your Title" required><br>
            <input type="email" id="email" name="email" placeholder="您的邮箱/ Your Email" required><br>
            <button onclick="submitPersonalInfo()">Submit</button>
        </div>

        <!-- Result display -->
        <div id="result-container">
            <h2>答题完成~ / Quiz Completed!</h2>
            <h2>结果已保存至桌面 / Result has been saved to the desktop</h2>
            <h2>请将结果发送至邮箱 / Please send the results to email</h2>
            <h2>lt@jsiec.org</h2>
            <h2>感谢您的参与！ / Thank you and have a good day~</h2>
        </div>

        <!-- Overlay -->
        <div id="overlay" onclick="hideOverlay()">
            <img id="overlay-image" src="" alt="Overlay Image">
        </div>
    </div>

    <!-- External JS library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <!-- Your JavaScript code -->
    <script>
        // JavaScript code for the quiz

        // Array to store user responses
        const userResponses = [];

        // Array to store the paths of all images
        const imagePaths = [
            "RetiZero1.0/1.jpg",
            "RetiZero1.0/2.png",
            "RetiZero1.0/3.jpg",
            "RetiZero1.0/4.jpg",
            "RetiZero1.0/5.png",
            "RetiZero1.0/6.jpg",
            "RetiZero1.0/7.jpg",
            "RetiZero1.0/8.png",
            "RetiZero1.0/9.png",
            "RetiZero1.0/10.png",
            "RetiZero1.0/11.jpg",
            "RetiZero1.0/12.png",
            "RetiZero1.0/13.jpg",
            "RetiZero1.0/14.jpg",
            "RetiZero1.0/15.png",
            "RetiZero1.0/16.png",
            "RetiZero1.0/17.jpg",
            "RetiZero1.0/18.jpg",
            "RetiZero1.0/19.jpg",
            "RetiZero1.0/20.jpg",
            "RetiZero1.0/21.jpg",
            "RetiZero1.0/22.jpg",
            "RetiZero1.0/23.jpg",
            "RetiZero1.0/24.png",
            "RetiZero1.0/25.jpg",
            "RetiZero1.0/26.jpg",
            "RetiZero1.0/27.jpg",
            "RetiZero1.0/28.png",
            "RetiZero1.0/29.png",
            "RetiZero1.0/30.jpg",
            "RetiZero1.0/31.jpg",
            "RetiZero1.0/32.jpg",
            "RetiZero1.0/33.jpg",
            "RetiZero1.0/34.jpg",
            "RetiZero1.0/35.png",
            "RetiZero1.0/36.jpg",
            "RetiZero1.0/37.jpg",
            "RetiZero1.0/38.jpg",
            "RetiZero1.0/39.png",
            "RetiZero1.0/40.png",
            "RetiZero1.0/41.jpg",
            "RetiZero1.0/42.jpg",
            "RetiZero1.0/43.jpg",
            "RetiZero1.0/44.jpg",
            "RetiZero1.0/45.jpg",
            "RetiZero1.0/46.jpg",
            "RetiZero1.0/47.jpg",
            "RetiZero1.0/48.jpg",
            "RetiZero1.0/49.jpg",
            "RetiZero1.0/50.jpg",
            "RetiZero1.0/51.jpg",
            "RetiZero1.0/52.png",
            "RetiZero1.0/53.jpg",
            "RetiZero1.0/54.png",
            "RetiZero1.0/55.jpg",
            "RetiZero1.0/56.jpg",
            "RetiZero1.0/57.png",
            "RetiZero1.0/58.jpg",
            "RetiZero1.0/59.png",
            "RetiZero1.0/60.png",
            "RetiZero1.0/61.jpg",
            "RetiZero1.0/62.jpg",
            "RetiZero1.0/63.jpg",
            "RetiZero1.0/64.jpg",
            "RetiZero1.0/65.jpg",
            "RetiZero1.0/66.jpg",
            "RetiZero1.0/67.png",
            "RetiZero1.0/68.png",
            "RetiZero1.0/69.jpg",
            "RetiZero1.0/70.jpg",
            "RetiZero1.0/71.jpg",
            "RetiZero1.0/72.jpg",
            "RetiZero1.0/73.jpg",
            "RetiZero1.0/74.jpg",
            "RetiZero1.0/75.jpg",
            "RetiZero1.0/76.jpg",
            "RetiZero1.0/77.jpg",
            "RetiZero1.0/78.jpg",
            "RetiZero1.0/79.jpg",
            "RetiZero1.0/80.jpg",
            "RetiZero1.0/81.png",
            "RetiZero1.0/82.jpg",
            "RetiZero1.0/83.png",
            "RetiZero1.0/84.jpg",
            "RetiZero1.0/85.jpg",
            "RetiZero1.0/86.jpg",
            "RetiZero1.0/87.png",
            "RetiZero1.0/88.jpg",
            "RetiZero1.0/89.jpg",
            "RetiZero1.0/90.png",
            "RetiZero1.0/91.jpg",
            "RetiZero1.0/92.jpg",
            "RetiZero1.0/93.jpg",
            "RetiZero1.0/94.jpg",
            "RetiZero1.0/95.jpg",
            "RetiZero1.0/96.png",
            "RetiZero1.0/97.jpg",
            "RetiZero1.0/98.png",
            "RetiZero1.0/99.png",
            "RetiZero1.0/100.jpg",
            "RetiZero1.0/101.jpg",
            "RetiZero1.0/102.jpg",
            "RetiZero1.0/103.jpg",
            "RetiZero1.0/104.jpg",  
            // Add more image paths as needed
        ];

        // Array of fixed options for all questions
        const options = [
            "0.Acute Posterior Multifocal Placoid Pigment Epitheliopathy",
            "1.Acute Retinal Necrosis",
            "2.Albinism",
            "3.Angioid Streaks",
            "4.Asteroid Hyalosis",
            "5.Behcet disease",
            "6.BEST disease",
            "7.Bietti Crystalline Dystrophy",
            "8.Branch Retinal Vein Occlusion",
            "9.Central Retinal Vein Occlusion",
            "10.Central Serous Chorioretinopathy",
            "11.Chorioretinal Coloboma",
            "12.Choroidal Metastasis",
            "13.Choroidal Rupture",
            "14.Commotio Retinae",
            "15.Moderate Non-Proliferative Diabetic Retinopathy",
            "16.Severe Non-Proliferative Diabetic Retinopathy",
            "17.Proliferative Diabetic Retinopathy",
            "18.Epiretinal Membrane",
            "19.Geographic Atrophy",
            "20.Glaucoma",
            "21.Hypertensive Retinopathy",
            "22.Intraocular Foreign Body",
            "23.Leber Congenital Amaurosis",
            "24.Leukemic Retinopathy",
            "25.Lipemia Retinalis",
            "26.Macular Hole",
            "27.Morning Glory Anomaly",
            "28.Multiple Evanescent White-Dot Syndromes",
            "29.Myelinated Nerve Fiber",
            "30.Neovascular Age-related Macular Degeneration",
            "31.Normal",
            "32.Optic Atrophy",
            "33.Optic Disc Coloboma",
            "34.Pathologic Myopia",
            "35.Pigmented Paravenous Retinochoroidal Atrophy",
            "36.Polypoidal Choroidal Vasculopathy",
            "37.Presumed Ocular Histoplasmosis Syndrome",
            "38.Punctate Inner Choroidopathy_Multifocal Choroiditis",
            "39.Purtscher Retinopathy",
            "40.Retinal Arterial Macroaneurysm",
            "41.Retinal Detachment",
            "42.Retinal Racemose Hemangioma",
            "43.Retinitis Pigmentosa",
            "44.Retinoblastoma",
            "45.Roth Spots",
            "46.Serpiginous Choroidopathy",
            "47.Stargardt disease",
            "48.Syphilitic Uveitis",
            "49.Valsalva Retinopathy",
            "50.Vogt-Koyanagi-Harada disease",
            "51.X-linked Retinoschisis", 
            // Add more options as needed
        ];

        // Variable to keep track of current question index
        let currentQuestionIndex = 0;

        // Variable to store start time of the quiz
        let quizStartTime;
        let selectedOptions = []; // Array to store user's selected options

        // Function to load the next question
        function loadNextQuestion() {
            if (currentQuestionIndex < imagePaths.length) {
                const questionNumber = document.getElementById("question-number");
                questionNumber.innerText = `No. ${currentQuestionIndex + 1} /104 `;

                const imagePath = imagePaths[currentQuestionIndex];
                const questionImage = document.getElementById("question-image");
                questionImage.src = imagePath;

                // Clear previous options
                const optionsContainer = document.getElementById("options-container");
                optionsContainer.innerHTML = "";

                // Add options dynamically
                options.forEach((option, index) => {
                    const optionElement = document.createElement("div");
                    optionElement.classList.add("option");
                    optionElement.innerText = option;
                    optionElement.addEventListener("click", () => handleOptionClick(index));
                    optionsContainer.appendChild(optionElement);
                });

                // Highlight the selected option, if any
                if (selectedOptions[currentQuestionIndex] !== undefined) {
                    const selectedOptionIndex = selectedOptions[currentQuestionIndex];
                    document.getElementsByClassName("option")[selectedOptionIndex].classList.add("selected");
                }

                // Increment question index
                currentQuestionIndex++;

                // Start the timer if it's the first question
                if (currentQuestionIndex === 1) {
                    quizStartTime = new Date();
                }
            } else {
                // Hide question display and image container
                document.getElementById("question-display").style.display = "none";
                document.getElementById("question-image-container").style.display = "none";

                // Show personal info form
                document.getElementById("personal-info-form").style.display = "block";
            }
        }

        function loadPrevQuestion() {
            if (currentQuestionIndex > 1) {
                // Decrement question index
                currentQuestionIndex--;

                // Load the previous question
                const questionNumber = document.getElementById("question-number");
                questionNumber.innerText = `No. ${currentQuestionIndex} /104 `;

                const imagePath = imagePaths[currentQuestionIndex - 1];
                const questionImage = document.getElementById("question-image");
                questionImage.src = imagePath;

                // Clear previous options
                const optionsContainer = document.getElementById("options-container");
                optionsContainer.innerHTML = "";

                // Add options dynamically
                options.forEach((option, index) => {
                    const optionElement = document.createElement("div");
                    optionElement.classList.add("option");
                    optionElement.innerText = option;
                    optionElement.addEventListener("click", () => handleOptionClick(index));                    
                    optionsContainer.appendChild(optionElement);
                });

                // Highlight the selected option, if any
                if (selectedOptions[currentQuestionIndex - 1] !== undefined) {
                    const selectedOptionIndex = selectedOptions[currentQuestionIndex - 1];
                    document.getElementsByClassName("option")[selectedOptionIndex].classList.add("selected");
                }
            }
        }

        // Function to handle option click
        function handleOptionClick(index) {
            // Store selected option for the current question
            selectedOptions[currentQuestionIndex - 1] = index;

            // Highlight the selected option
            const options = document.getElementsByClassName("option");
            for (let i = 0; i < options.length; i++) {
                options[i].classList.remove("selected");
            }
            options[index].classList.add("selected");
        }

        // Function to show the overlay with the image
        function showOverlay() {
            const overlay = document.getElementById("overlay");
            const overlayImage = document.getElementById("overlay-image");
            overlayImage.src = document.getElementById("question-image").src;
            overlay.style.display = "flex";
        }

        // Function to hide the overlay
        function hideOverlay() {
            const overlay = document.getElementById("overlay");
            overlay.style.display = "none";
        }

        // Function to submit personal info
        function submitPersonalInfo() {
            const name = document.getElementById("name").value;
            const title = document.getElementById("title").value;
            const email = document.getElementById("email").value;

            if (name && title && email) {
                // Save the user's personal info and responses to a file
                saveResponsesToFile(name, title, email);

                // Hide personal info form
                document.getElementById("personal-info-form").style.display = "none";

                // Show result container
                document.getElementById("result-container").style.display = "block";
            } else {
                alert("请填写所有必填信息 / Please fill in all required fields.");
            }
        }

        // Function to save responses to a file
        function saveResponsesToFile(name, title, email) {
            // Calculate total quiz time
            const quizEndTime = new Date();
            const quizTime = (quizEndTime - quizStartTime) / 1000;

            // Prepare data for export
            const data = [
                ["Name", name],
                ["Title", title],
                ["Email", email],
                ["Total Quiz Time (seconds)", quizTime],
                [],
                ["Question Number", "Selected Option"]
            ];

            selectedOptions.forEach((optionIndex, questionIndex) => {
                data.push([questionIndex + 1, options[optionIndex]]);
            });

            // Convert data to worksheet
            const ws = XLSX.utils.aoa_to_sheet(data);

            // Create a new workbook and append the worksheet
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Responses");

            // Write the workbook to a file and save it to the user's desktop
            const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'binary' });
            const blob = new Blob([s2ab(wbout)], { type: "application/octet-stream" });
            saveAs(blob, "Quiz_Responses.xlsx");
        }

        // Utility function to convert string to ArrayBuffer
        function s2ab(s) {
            const buf = new ArrayBuffer(s.length);
            const view = new Uint8Array(buf);
            for (let i = 0; i < s.length; i++) {
                view[i] = s.charCodeAt(i) & 0xFF;
            }
            return buf;
        }

        // Initialize the quiz
        loadNextQuestion();
    </script>
</body>
</html>

                   
